// Preact Logging API - Javascript Client
// Copyright 2012-2013 Less Neglect / Christopher Gooley
// version 2.4b 2013-04-25

if(typeof JSON!=="object"){JSON={}}(function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];if(a&&typeof a==="object"&&typeof a.toJSON==="function"){a=a.toJSON(e)}if(typeof rep==="function"){a=rep.call(t,e,a)}switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep==="object"){s=rep.length;for(n=0;n<s;n+=1){if(typeof rep[n]==="string"){r=rep[n];i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}else{for(r in a){if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n==="number"){for(r=0;r<n;r+=1){indent+=" "}}else if(typeof n==="string"){indent=n}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();_lnq=function(){var e="https://api.preact.io/t/v21";var t={code:null,debug:false,person_id:null,person:null,account:null};var n=function(e){if(t.debug){console.log(e)}};var r=function(e){if(!e){return false}try{n("handling: "+e.join(" | "))}catch(r){}var o=e[0];switch(o){case"_setCode":{t.code=e[1];break};case"_setDebug":{t.debug=e[1];break};case"_setPerson":{t.person_id=e[1];break};case"_setPersonData":{t.person=e[1];break};case"_setAccount":{t.account=e[1];break};case"_setPersonProperty":{if(!t.person_id&&!t.person){n("ERROR: must _setPerson or _setPersonData before setting additional properties");return false}if(e.length!=3){n("ERROR: _setPersonProperty takes two ordered parameters: property_name and property_value")}t.person.properties=t.person.properties||{};t.person.properties[e[1]]=e[2]};case"_logPageview":{var u=window.location.href;var a=document.title;var f={klass:"actionevent",name:"___viewed:page",external_identifer:u,note:a};var l={person:t.person,event:f};var c=s(l);n(c);break};case"_logEvent":{if(!i(e)){return false}var f={};if(typeof e[1]=="object"){f=e[1];if(e.length>=3){f.extras=e[2]}}else if(typeof e[1]=="string"){f={name:e[1]};if(e.length>=3){f.note=e[2]}}f.klass="actionevent";f.magnitude=f.magnitude||1;var l={person:t.person,event:f};var c=s(l);n(c);break};default:{n("unknown command: "+o);return false}}};var i=function(e){if(!e||e.length<2){n("ERROR: event data missing");return false}if(!t.person_id&&!t.person){n("ERROR: must _setPerson or _setPersonData before sending events");return false}return true};var s=function(n){n.code=t.code;var r=window.location.href;var i=document.title;var s=navigator.userAgent;var o=document.referrer;n.event=n.event||{};n.event.extras=n.event.extras||{};n.event.extras["_ua"]=s;n.event.extras["_referrer"]=o;n.event.extras["_url"]=r;n.event.extras["_page_title"]=i;if(t.account){if(t.account.id){n.event.account=t.account}}n.event.source="lessneglect-js:2.4a";n.event.links=n.event.links||[];if(n.event.link_url){n.event.links.push({name:"link_url",href:n.event.link_url});n.event.link_url=null}if(n.event.thumbnail_url){n.event.links.push({name:"thumbnail_url",href:n.event.thumbnail_url});n.event.thumbnail_url=null}try{var a=JSON.stringify(n);var f=u.encode(a);var l=e+"?data="+f+"&t="+(new Date).getTime();var c=new Image;c.src=l;return l}catch(h){return"failed to log event"}};var o=function(){n("init");var e=window._lnq;if(e&&e.length>0){for(var t=0;t<e.length;t++){r(e[t])}}};var u={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,a,f;var l=0;e=u._utf8_encode(e);while(l<e.length){n=e.charCodeAt(l++);r=e.charCodeAt(l++);i=e.charCodeAt(l++);s=n>>2;o=(n&3)<<4|r>>4;a=(r&15)<<2|i>>6;f=i&63;if(isNaN(r)){a=f=64}else if(isNaN(i)){f=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(f)}return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t}};o();return{push:r}}()